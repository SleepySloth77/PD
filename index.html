<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prisoner's Dilemma Simulation with Graph</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(120deg, #74ebd5, #9face6);
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 20px;
    margin: 0;
  }

  .game-container {
    text-align: center;
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0px 8px 20px rgba(0,0,0,0.2);
    width: 600px;
  }

  select, input, button {
    margin: 10px;
    padding: 8px;
    font-size: 14px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  button {
    background: linear-gradient(45deg, #6a11cb, #2575fc);
    color: white;
    border: none;
    cursor: pointer;
  }

  button:hover {
    transform: scale(1.05);
    background: linear-gradient(45deg, #2575fc, #6a11cb);
  }

  table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
  }

  table, th, td {
    border: 1px solid #ccc;
  }

  th, td {
    padding: 8px;
    text-align: center;
  }

  .scoreboard {
    margin-top: 15px;
    padding: 10px;
    background: #f3f3f3;
    border-radius: 10px;
  }

  canvas {
    margin-top: 25px;
    background: #f9f9f9;
    border-radius: 10px;
    padding: 10px;
  }
</style>
</head>
<body>
<div class="game-container">
  <h2>Prisoner's Dilemma Simulation ü§ùüíî</h2>

  <div>
    <label>Player A Strategy: </label>
    <select id="strategyA">
      <option>Always Cooperate</option>
      <option>Always Defect</option>
      <option>Random</option>
      <option>Tit-for-Tat</option>
    </select>
  </div>

  <div>
    <label>Player B Strategy: </label>
    <select id="strategyB">
      <option>Always Cooperate</option>
      <option>Always Defect</option>
      <option>Random</option>
      <option>Tit-for-Tat</option>
    </select>
  </div>

  <div>
    <label>Number of Rounds: </label>
    <input type="number" id="rounds" value="10" min="1" max="100">
  </div>

  <button onclick="runSimulation()">‚ñ∂Ô∏è Run Simulation</button>

  <table id="resultsTable">
    <thead>
      <tr>
        <th>Round</th>
        <th>Player A</th>
        <th>Player B</th>
        <th>Outcome</th>
        <th>A Years</th>
        <th>B Years</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="scoreboard" id="scoreboard">
    Total Years ‚Üí Player A: 0 | Player B: 0
  </div>

  <canvas id="chart" height="200"></canvas>
</div>

<script>
  let chart;

  function chooseMove(strategy, lastOpponentMove) {
    if (strategy === "Always Cooperate") return "Cooperate";
    if (strategy === "Always Defect") return "Defect";
    if (strategy === "Random") return Math.random() < 0.5 ? "Cooperate" : "Defect";
    if (strategy === "Tit-for-Tat") return lastOpponentMove || "Cooperate";
  }

  function runSimulation() {
    const strategyA = document.getElementById("strategyA").value;
    const strategyB = document.getElementById("strategyB").value;
    const rounds = parseInt(document.getElementById("rounds").value);

    let totalA = 0;
    let totalB = 0;
    let lastA = null, lastB = null;

    const tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = ""; // clear old results

    let labels = [];
    let dataA = [];
    let dataB = [];

    for (let r = 1; r <= rounds; r++) {
      let moveA = chooseMove(strategyA, lastB);
      let moveB = chooseMove(strategyB, lastA);

      let yearsA = 0, yearsB = 0, outcome = "";

      if (moveA === "Cooperate" && moveB === "Cooperate") {
        yearsA = yearsB = 2;
        outcome = "Both Cooperate";
      } else if (moveA === "Cooperate" && moveB === "Defect") {
        yearsA = 5; yearsB = 0;
        outcome = "A betrayed";
      } else if (moveA === "Defect" && moveB === "Cooperate") {
        yearsA = 0; yearsB = 5;
        outcome = "B betrayed";
      } else {
        yearsA = yearsB = 4;
        outcome = "Both Defect";
      }

      totalA += yearsA;
      totalB += yearsB;

      lastA = moveA;
      lastB = moveB;

      const row = `<tr>
        <td>${r}</td>
        <td>${moveA}</td>
        <td>${moveB}</td>
        <td>${outcome}</td>
        <td>${yearsA}</td>
        <td>${yearsB}</td>
      </tr>`;
      tbody.innerHTML += row;

      labels.push(r);
      dataA.push(totalA);
      dataB.push(totalB);
    }

    document.getElementById("scoreboard").innerHTML = 
      `Total Years ‚Üí Player A: ${totalA} | Player B: ${totalB}`;

    // Render chart
    if(chart) chart.destroy();
    const ctx = document.getElementById('chart').getContext('2d');
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [
          { label: 'Player A', data: dataA, borderColor: 'blue', fill: false, tension: 0.2 },
          { label: 'Player B', data: dataB, borderColor: 'red', fill: false, tension: 0.2 }
        ]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'top' } },
        scales: {
          y: { title: { display: true, text: 'Cumulative Years' }, beginAtZero: true },
          x: { title: { display: true, text: 'Round' } }
        }
      }
    });
  }
</script>
</body>
</html>
